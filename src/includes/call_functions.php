<?php

session_start();

// Include config and functions files
//-----------------------------------
include("../config/config.php");

foreach(glob('./*.inc.php') as $fileName)
{
    include_once $fileName;
}
////////////////////////////////////////




// Switch to call php function by jquery load
//-------------------------------------------
switch($_GET['todo'])
{

	// Scan user directory, add movies don't found and display movies found
	//---------------------------------------------------------------------
    case 'scan':

		// Call function
		//--------------
		$aMovieFromDisk = DirToArray(USERFOLDER);
		$aMovieNotFound = SearchInMovieDB($aMovieFromDisk['final']);
		AddUnCorrectMovie($aMovieNotFound);
		/////////////////////////////////////////


        // Call function to get film and print it
        //---------------------------------------
        print(GetAllMovies());


        break;


//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//


	// Display to user how many movies not found
	//--------------------------------------------
    case 'moviesnotfound':

		// Call function
		//--------------
        print(GetNumberUnCorrectMovie());


        break;


//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//


	// Display modal to correct movies not found
	//------------------------------------------
    case 'displaymodalcorrect':

		// Call function
		//--------------
        print(GetUnCorrectMovie());


        break;


//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//


	// Display in modal the description of the movie
	//----------------------------------------------
    case 'showDetails' :

		// Call function with the id of the movie
		//---------------------------------------
        print(GetFilmDescription($_GET['id']));


        break;


//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//


	// Display all movies when user comme to the website
	//--------------------------------------------------
    case 'getallmovies':

        // Call function to get film and print it
        //---------------------------------------
        print(GetAllMovies());


		break;


//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//


	// Search function and display result
	//-----------------------------------
    case 'searchMovies':

    	// Call function
    	//--------------
        $aMovie = GetSearchMovies($_GET['queryT'], $_GET['queryA'], $_GET['queryG'], $_GET['queryY']);


		// Check if somethink is write in each search fields
		//---------------------------------------------------
        if(count($aMovie) == 0 && ($_GET['queryT'] != "" || $_GET['queryA'] != "" || $_GET['queryG'] != "" || $_GET['queryY'] != ""))
        {
        	// KO
            print("<div id='notfoundcontent'>NO MOVIE FOUND !</div>");

        }
        else if(count($aMovie) == 0 && $_GET['queryT'] == "" && $_GET['queryA'] == "" && $_GET['queryG'] == "" && $_GET['queryY'] == "")
        {
        	// OK
            print(GetAllMovies());
        }
		/////////////////////////////////////////////////////


		print($aMovie);


        break;


//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//


	// Execute a new search about uncorrect movies with change of user
	//----------------------------------------------------------------
	case 'searchCorrectedMovie':

		print_r(SearchCorrectedMoviesInMovieDB());


	break;


//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------//


	// Get all genre for search field
	//-------------------------------
    case 'getallgenres':


    	// Call function
    	//--------------
        print(GetAllGenres());


        break;


	case 'verifConnect':

		// Call function
		print(CheckConnection());

		break;
}

?>